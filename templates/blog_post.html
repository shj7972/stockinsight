{% extends "base.html" %}

{% block title %}{{ post.title }} - Stock Insight AI{% endblock %}

{% block meta_description %}{{ post.seo_description }}{% endblock %}

{% block meta_keywords %}{{ post.seo_keywords }}{% endblock %}

{% block og_title %}{{ post.title }}{% endblock %}

{% block og_description %}{{ post.excerpt }}{% endblock %}

{% block canonical_path %}/blog/{{ post.slug }}{% endblock %}

{% block og_url %}/blog/{{ post.slug }}{% endblock %}

{% block structured_data %}
<script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Article",
    "headline": "{{ post.title }}",
    "description": "{{ post.seo_description }}",
    "datePublished": "{{ post.date_published }}",
    "dateModified": "{{ post.date_modified }}",
    "author": {
        "@type": "Organization",
        "name": "{{ post.author }}"
    },
    "publisher": {
        "@type": "Organization",
        "name": "Stock Insight AI",
        "logo": {
            "@type": "ImageObject",
            "url": "https://stock-insight.app/static/og-image.png"
        }
    },
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "https://stock-insight.app/blog/{{ post.slug }}"
    },
    "articleSection": "{{ post.category }}",
    "keywords": "{{ post.seo_keywords }}"
}
</script>
{% endblock %}

{% block content %}
<!-- Breadcrumb -->
<div style="margin-bottom: 1rem; font-size: 0.8rem; color: #64748b;">
    <a href="/" style="color: #64748b; text-decoration: none;">Ìôà</a>
    <span style="margin: 0 0.4rem;">‚Ä∫</span>
    <a href="/blog" style="color: #64748b; text-decoration: none;">Î∏îÎ°úÍ∑∏</a>
    <span style="margin: 0 0.4rem;">‚Ä∫</span>
    <span style="color: #94a3b8;">{{ post.title[:30] }}{% if post.title|length > 30 %}...{% endif %}</span>
</div>

<!-- Article Header -->
<article>
    <div class="glass-panel" style="padding: 1.5rem; margin-bottom: 1.5rem;">
        <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 1rem;">
            <span class="blog-category-badge">{{ post.category }}</span>
            <span style="font-size: 0.75rem; color: #475569;">{{ post.date_published }}</span>
            <span style="font-size: 0.75rem; color: #475569;">¬∑ {{ post.author }}</span>
        </div>

        <h1 style="font-size: 1.6rem; margin: 0 0 1rem 0; line-height: 1.4;
            background: linear-gradient(135deg, #f8fafc 0%, #cbd5e1 100%);
            -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent;">
            {{ post.title }}
        </h1>

        <p style="color: #94a3b8; font-size: 0.9rem; line-height: 1.6; margin: 0;">
            {{ post.excerpt }}
        </p>

        <!-- Share & Tags -->
        <div style="display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 0.5rem;
                    margin-top: 1.25rem; padding-top: 1rem; border-top: 1px solid rgba(255,255,255,0.06);">
            <div style="display: flex; flex-wrap: wrap; gap: 0.3rem;">
                {% for tag in post.tags %}
                <span class="blog-tag">#{{ tag }}</span>
                {% endfor %}
            </div>
            <div style="display: flex; gap: 0.4rem;">
                <button onclick="shareBlogToTwitter()" class="blog-share-btn" title="Ìä∏ÏúÑÌÑ∞ Í≥µÏú†">üê¶</button>
                <button onclick="shareBlogToFacebook()" class="blog-share-btn" title="ÌéòÏù¥Ïä§Î∂Å Í≥µÏú†">üìò</button>
                <button onclick="copyBlogLink()" class="blog-share-btn" title="ÎßÅÌÅ¨ Î≥µÏÇ¨">üìã</button>
            </div>
        </div>
    </div>

    <!-- Article Body -->
    <div class="glass-panel blog-content" style="padding: 2rem 1.5rem;">
        {{ post.content|safe }}
    </div>
</article>

<!-- Related Posts -->
{% if related_posts %}
<div style="margin-top: 2rem;">
    <div style="display: flex; align-items: center; gap: 0.4rem; margin-bottom: 1rem;">
        <span>üìö</span>
        <span style="font-size: 0.9rem; font-weight: 700; color: #e2e8f0;">Îã§Î•∏ Í∏ÄÎèÑ ÏùΩÏñ¥Î≥¥ÏÑ∏Ïöî</span>
    </div>
    <div class="blog-grid">
        {% for rp in related_posts %}
        <a href="/blog/{{ rp.slug }}" class="blog-card">
            <div style="display: flex; align-items: center; gap: 0.4rem; margin-bottom: 0.5rem;">
                <span class="blog-category-badge">{{ rp.category }}</span>
                <span style="font-size: 0.72rem; color: #475569; margin-left: auto;">{{ rp.date_published }}</span>
            </div>
            <h2 class="blog-card-title" style="font-size: 0.95rem;">{{ rp.title }}</h2>
            <p class="blog-card-excerpt">{{ rp.excerpt[:80] }}...</p>
            <div style="margin-top: auto; padding-top: 0.5rem; font-size: 0.78rem; color: #38bdf8; font-weight: 600;">
                ÏùΩÏñ¥Î≥¥Í∏∞ ‚Üí
            </div>
        </a>
        {% endfor %}
    </div>
</div>
{% endif %}

<script>
    const blogShareUrl = "https://stock-insight.app/blog/{{ post.slug }}";
    const blogShareTitle = "{{ post.title }}";

    function shareBlogToTwitter() {
        const text = encodeURIComponent(blogShareTitle);
        const url = encodeURIComponent(blogShareUrl);
        window.open('https://twitter.com/intent/tweet?text=' + text + '&url=' + url, '_blank', 'width=600,height=400');
    }

    function shareBlogToFacebook() {
        const url = encodeURIComponent(blogShareUrl);
        window.open('https://www.facebook.com/sharer/sharer.php?u=' + url, '_blank', 'width=600,height=400');
    }

    function copyBlogLink() {
        navigator.clipboard.writeText(blogShareUrl).then(function() {
            alert('ÎßÅÌÅ¨Í∞Ä Î≥µÏÇ¨ÎêòÏóàÏäµÎãàÎã§!');
        }).catch(function() {
            alert('ÎßÅÌÅ¨: ' + blogShareUrl);
        });
    }
</script>
{% endblock %}