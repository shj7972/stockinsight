{% extends "base.html" %}

{% block title %}ETF íƒí—˜ê°€ - Stock Insight AI{% endblock %}

{% block content %}
<div class="glass-panel" style="padding: 1.25rem; margin-bottom: 2rem;">
    <h3 style="margin: 0; font-size: 1.5rem; display: flex; align-items: center; gap: 0.5rem;">
        <span style="font-size: 2rem;">ğŸ”­</span> ETF íƒí—˜ê°€
    </h3>
    <p style="color: #94a3b8; margin-top: 0.5rem;">
        ì¸ê¸° ìˆëŠ” ETFë¥¼ í…Œë§ˆë³„ë¡œ ì‚´í´ë³´ê³  ì¦‰ì‹œ ë¶„ì„í•´ë³´ì„¸ìš”.
    </p>
</div>

{% if stock_data %}
<!-- Analysis Dashboard (Similar to Index) -->
<!-- Stock Analysis Section -->
<div class="stock-header glass-panel {{ stock_data.verdict_class }}">
    <div class="stock-title-section">
        <h1 class="gradient-text">{{ stock_data.company_name }} ({{ stock_data.ticker }})</h1>
        <div class="verdict-badge"
            style="background: {{ stock_data.verdict_color }}22; color: {{ stock_data.verdict_color }}; border-color: {{ stock_data.verdict_color }}44;">
            {{ stock_data.verdict }}
        </div>
    </div>
    <div class="stock-price-section">
        <div class="price-label">í˜„ì¬ê°€</div>
        <div class="price-value">{{ stock_data.currency_symbol }}{{ "{:,.2f}".format(stock_data.current_price) }}</div>
        <div class="price-change {% if stock_data.delta >= 0 %}positive{% else %}negative{% endif %}">
            {{ "{:+.2f}".format(stock_data.delta) }}
        </div>
    </div>
</div>

<!-- Tabs -->
<div class="tabs-container">
    <div class="tabs">
        <button class="tab-btn active" onclick="showTab('chart', this)">ğŸ“Š ì°¨íŠ¸ & ë¶„ì„</button>
        <button class="tab-btn" onclick="showTab('financial', this)">ğŸ“‹ ì¬ë¬´ ì •ë³´</button>
        <button class="tab-btn" onclick="showTab('news', this)">ğŸ“° ë‰´ìŠ¤ & í‰íŒ</button>
        <button class="tab-btn" onclick="showTab('advice', this)">ğŸ¤– AI ì¡°ì–¸</button>
    </div>

    <!-- Chart Tab -->
    <div id="chart-tab" class="tab-content active">
        <div class="glass-panel" style="padding: 1.5rem;">
            <div id="chart-container" style="width: 100%; height: 650px; min-height: 650px;"></div>
        </div>
    </div>

    <!-- Financial Tab -->
    <div id="financial-tab" class="tab-content">
        <div class="glass-panel">
            <h3>ğŸ“ ê¸°ì—… ê°œìš”</h3>
            <div class="summary-text">{{ stock_data.summary }}</div>
        </div>

        <div class="glass-panel">
            <h3>ğŸ’ ì£¼ìš” ì§€í‘œ</h3>
            <div class="metrics-grid">
                <div class="metric-card">
                    <div class="metric-label">ì‹œê°€ì´ì•¡</div>
                    <div class="metric-value">{{ "{:,}".format(stock_data.market_cap) }}</div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">PER</div>
                    <div class="metric-value">{{ stock_data.pe_ratio }}</div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">ë°°ë‹¹ìˆ˜ìµë¥ </div>
                    <div class="metric-value">
                        {% if stock_data.dividend_yield %}
                        {{ "{:.2f}".format(stock_data.dividend_yield) }}%
                        {% else %}
                        N/A
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- News Tab -->
    <div id="news-tab" class="tab-content">
        <div class="glass-panel">
            <h3>ğŸŒ ì‹¤ì‹œê°„ ë‰´ìŠ¤ ë° ì‹œì¥ ì‹¬ë¦¬</h3>
        </div>

        {% if stock_data.sentiment_details %}
        <div class="glass-panel sentiment-summary">
            <div class="sentiment-item">
                <div class="sentiment-label">í‰ê·  ê°ì„± ì ìˆ˜</div>
                <div class="sentiment-value">{{ "{:.2f}".format(stock_data.sentiment_score) }}</div>
                <div class="sentiment-range">(-1.0 ~ 1.0)</div>
            </div>
            <div class="sentiment-item">
                <div class="sentiment-label">ë¶„ì„ëœ ë‰´ìŠ¤</div>
                <div class="sentiment-value">{{ stock_data.news_count }}</div>
                <div class="sentiment-range">ê°œ</div>
            </div>
        </div>

        <div class="news-list">
            {% for item in stock_data.sentiment_details %}
            <details class="news-item">
                <summary>
                    <span class="sentiment-icon">
                        {% if item.compound > 0.05 %}ğŸŸ¢
                        {% elif item.compound < -0.05 %}ğŸ”´ {% else %}âšª{% endif %} </span>
                            {{ item.translated_title }}
                </summary>
                <div class="news-details">
                    <p><strong>ì¶œì²˜:</strong> {{ item.publisher }}</p>
                    <p><strong>ê°ì„± ì ìˆ˜:</strong> {{ "{:.3f}".format(item.compound) }}</p>
                    {% if item.link and item.link != '#' %}
                    <p><a href="{{ item.link }}" target="_blank">ê¸°ì‚¬ ì½ê¸°</a></p>
                    {% endif %}
                </div>
            </details>
            {% endfor %}
        </div>
        {% else %}
        <div class="glass-panel">
            <p>'{{ stock_data.ticker }}'ì— ëŒ€í•œ ìµœì‹  ë‰´ìŠ¤ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>
        </div>
        {% endif %}
    </div>

    <!-- Advice Tab -->
    <div id="advice-tab" class="tab-content">
        <div class="glass-panel">
            <h3>ğŸ’¡ AI íˆ¬ì ì „ëµ ì œì•ˆ</h3>
        </div>

        {% for advice in stock_data.advice_list %}
        <div class="advice-item" style="border-left-color: {{ advice.color }}; background: {{ advice.color }}22;">
            {{ advice.text }}
        </div>
        {% endfor %}
    </div>
</div>
{% endif %}

<div class="etf-container">
    {% for category in categories %}
    <div class="etf-category {{ category.theme }}">
        <div class="etf-category-header">
            <div class="category-icon">{{ category.icon }}</div>
            <div class="category-info">
                <h3>{{ category.title }}</h3>
                <p>{{ category.desc }}</p>
            </div>
        </div>

        <div class="etf-grid">
            {% for ticker, name, desc in category.etf_list %}
            <div class="etf-card">
                <div class="etf-header">
                    <span class="etf-ticker">{{ ticker }}</span>
                    <span class="etf-badge">ETF</span>
                </div>
                <div class="etf-name">{{ name }}</div>
                <div class="etf-desc">{{ desc }}</div>

                <form action="/etf-explorer" method="POST">
                    <input type="hidden" name="ticker" value="{{ ticker }}">
                    <button type="submit" class="etf-btn">ğŸ” {{ ticker }} ë¶„ì„í•˜ê¸°</button>
                </form>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endfor %}
</div>

<style>
    .etf-category {
        margin-bottom: 2rem;
    }

    .etf-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        gap: 1.5rem;
    }

    .etf-card {
        background: rgba(255, 255, 255, 0.03);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 12px;
        padding: 1.25rem;
        transition: all 0.2s;
        display: flex;
        flex-direction: column;
    }

    .etf-card:hover {
        background: rgba(30, 41, 59, 0.6);
        border-color: rgba(56, 189, 248, 0.3);
        transform: translateY(-4px);
    }

    .etf-header {
        display: flex;
        justify-content: space-between;
        align-items: start;
        margin-bottom: 0.5rem;
    }

    .etf-ticker {
        font-weight: 700;
        font-size: 1.2rem;
        color: #38bdf8;
    }

    .etf-badge {
        font-size: 0.75rem;
        color: #e2e8f0;
        background: rgba(56, 189, 248, 0.2);
        padding: 0.2rem 0.6rem;
        border-radius: 99px;
    }

    .etf-name {
        font-weight: 500;
        font-size: 1rem;
        margin-bottom: 0.3rem;
        color: #f1f5f9;
    }

    .etf-desc {
        font-size: 0.85rem;
        color: #94a3b8;
        margin-bottom: 1rem;
        flex-grow: 1;
    }

    .etf-btn {
        width: 100%;
        padding: 0.6rem;
        background: rgba(30, 41, 59, 0.5);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 8px;
        color: #e2e8f0;
        cursor: pointer;
        transition: all 0.2s;
    }

    .etf-btn:hover {
        background: #38bdf8;
        color: white;
        border-color: transparent;
    }
</style>

<script>
    {% if stock_data and stock_data.chart_json %}
    document.addEventListener('DOMContentLoaded', function () {
        var chartData = {{ stock_data.chart_json | tojson | safe
    }};
    if (chartData && chartData.data && chartData.layout) {
        Plotly.newPlot('chart-container', chartData.data, chartData.layout, {
            responsive: true,
            displayModeBar: false
        });
    }
    });
    {% endif %}

    function showTab(tabName, element) {
        document.querySelectorAll('.tab-content').forEach(tab => {
            tab.classList.remove('active');
        });
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.classList.remove('active');
        });
        document.getElementById(tabName + '-tab').classList.add('active');
        element.classList.add('active');
    }
</script>
{% endblock %}