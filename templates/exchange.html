{% extends "base.html" %}

{% block title %}í™˜ìœ¨ ê³„ì‚°ê¸° - Stock Insight AI{% endblock %}
{% block meta_description %}ì‹¤ì‹œê°„ í™˜ìœ¨ ê³„ì‚°ê¸° - USD, KRW, JPY, EUR ë“± 8ê°œ í†µí™” í™˜ìœ¨ ì¡°íšŒ ë° í™˜ì „ íƒ€ì´ë° ë¶„ì„{% endblock %}
{% block og_title %}í™˜ìœ¨ ê³„ì‚°ê¸° - Stock Insight AI{% endblock %}
{% block og_description %}ì‹¤ì‹œê°„ í™˜ìœ¨ ì¡°íšŒ ë° AI ê¸°ë°˜ í™˜ì „ íƒ€ì´ë° ë¶„ì„ ì„œë¹„ìŠ¤{% endblock %}

{% block content %}
<div class="glass-panel" style="padding: 1.25rem; margin-bottom: 2rem;">
    <h3 style="margin: 0; font-size: 1.5rem; display: flex; align-items: center; gap: 0.5rem;">
        <span style="font-size: 2rem;">ğŸ’±</span> í™˜ìœ¨ ê³„ì‚°ê¸°
    </h3>
    <p style="color: #94a3b8; margin-top: 0.5rem;">ì‹¤ì‹œê°„ í™˜ìœ¨ ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ í™˜ì „ ê¸ˆì•¡ì„ ê³„ì‚°í•©ë‹ˆë‹¤.</p>
</div>

{% if error %}
<div class="glass-panel" style="border-color: #fca5a5; color: #fca5a5;">
    âš ï¸ {{ error }}
</div>
{% else %}
<div style="display: grid; grid-template-columns: 1fr 0.2fr 1fr; align-items: center; gap: 1rem; margin-bottom: 3rem;">
    <!-- From -->
    <div class="glass-panel">
        <h3 style="margin-top: 0;">ğŸ“¤ ë³´ë‚´ëŠ” ê¸ˆì•¡</h3>
        <input type="number" id="amount" value="1" min="0" step="any" class="styled-input"
            style="font-size: 1.5rem; font-weight: bold; margin-bottom: 1rem;">
        <select id="fromCurr" class="styled-select">
            <option value="USD">USD (ë¯¸êµ­ ë‹¬ëŸ¬)</option>
            <option value="KRW">KRW (í•œêµ­ ì›)</option>
            <option value="JPY">JPY (ì¼ë³¸ ì—”)</option>
            <option value="EUR">EUR (ìœ ë¡œ)</option>
            <option value="GBP">GBP (ì˜êµ­ íŒŒìš´ë“œ)</option>
            <option value="CNY">CNY (ì¤‘êµ­ ìœ„ì•ˆ)</option>
            <option value="AUD">AUD (í˜¸ì£¼ ë‹¬ëŸ¬)</option>
            <option value="CAD">CAD (ìºë‚˜ë‹¤ ë‹¬ëŸ¬)</option>
        </select>
    </div>

    <!-- Icon -->
    <div style="text-align: center; font-size: 2rem;">â¡ï¸</div>

    <!-- To -->
    <div class="glass-panel">
        <h3 style="margin-top: 0;">ğŸ“¥ ë°›ëŠ” ê¸ˆì•¡</h3>
        <div id="resultValue"
            style="background: rgba(0,0,0,0.2); padding: 0.8rem; border-radius: 8px; font-size: 1.5rem; font-weight: bold; color: #38bdf8; margin-bottom: 1rem; border: 1px solid rgba(255,255,255,0.1); min-height: 50px;">
            -
        </div>
        <select id="toCurr" class="styled-select">
            <option value="KRW" selected>KRW (í•œêµ­ ì›)</option>
            <option value="USD">USD (ë¯¸êµ­ ë‹¬ëŸ¬)</option>
            <option value="JPY">JPY (ì¼ë³¸ ì—”)</option>
            <option value="EUR">EUR (ìœ ë¡œ)</option>
            <option value="GBP">GBP (ì˜êµ­ íŒŒìš´ë“œ)</option>
            <option value="CNY">CNY (ì¤‘êµ­ ìœ„ì•ˆ)</option>
            <option value="AUD">AUD (í˜¸ì£¼ ë‹¬ëŸ¬)</option>
            <option value="CAD">CAD (ìºë‚˜ë‹¤ ë‹¬ëŸ¬)</option>
        </select>
    </div>
</div>

<div class="glass-panel">
    <h3>ğŸŒ ì˜¤ëŠ˜ ê¸°ì¤€ í™˜ìœ¨ (1 USD ê¸°ì¤€)</h3>
    <div class="metrics-grid" style="margin-top: 0;">
        <div class="metric-card">
            <div class="metric-label">USD / KRW</div>
            <div class="metric-value">{{ rates['KRW']|round(2) }} ì›</div>
        </div>
        <div class="metric-card">
            <div class="metric-label">USD / JPY</div>
            <div class="metric-value">{{ rates['JPY']|round(2) }} ì—”</div>
        </div>
        <div class="metric-card">
            <div class="metric-label">EUR / USD</div>
            <div class="metric-value">{{ (1 / rates['EUR'])|round(4) }} ë‹¬ëŸ¬</div>
        </div>
        <div class="metric-card">
            <div class="metric-label">GBP / USD</div>
            <div class="metric-value">{{ (1 / rates['GBP'])|round(4) }} ë‹¬ëŸ¬</div>
        </div>
        <div class="metric-card">
            <div class="metric-label">USD / CNY</div>
            <div class="metric-value">{{ rates['CNY']|round(2) }} ìœ„ì•ˆ</div>
        </div>
        <div class="metric-card">
            <div class="metric-label">AUD / USD</div>
            <div class="metric-value">{{ (1 / rates['AUD'])|round(4) }} ë‹¬ëŸ¬</div>
        </div>
    </div>
</div>

{% if analysis %}
<div class="glass-panel" style="background: rgba(30, 41, 59, 0.6); border: 1px solid rgba(56, 189, 248, 0.2);">
    <h3 style="display: flex; align-items: center; gap: 0.5rem; margin-top: 0;">
        <span>ğŸ¤–</span> AI ìŠ¤ë§ˆíŠ¸ í™˜ì „ ì–´ë“œë°”ì´ì € (ìµœê·¼ 1ê°œì›” ê¸°ì¤€)
    </h3>
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
        <!-- USD Advice -->
        <div class="advice-card"
            style="background: rgba(15, 23, 42, 0.4); padding: 1rem; border-radius: 12px; border: 1px solid rgba(255,255,255,0.05);">
            <div style="font-weight: bold; font-size: 1.1rem; margin-bottom: 0.5rem; color: #e2e8f0;">ğŸ‡ºğŸ‡¸ USD/KRW ì „ëµ
            </div>
            <div
                style="font-size: 1.2rem; font-weight: 800; margin-bottom: 0.5rem; 
                color: {% if 'ë§¤ìˆ˜' in analysis['USD']['status'] %}#4ade80{% elif 'ê´€ë§' in analysis['USD']['status'] %}#f87171{% else %}#fbbf24{% endif %};">
                {{ analysis['USD']['status'] }}
            </div>
            <p style="font-size: 0.9rem; color: #cbd5e1; margin-bottom: 1rem; line-height: 1.4;">{{
                analysis['USD']['message'] }}</p>
            <div
                style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 0.5rem; font-size: 0.8rem; color: #94a3b8; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 0.5rem;">
                <div>
                    <div>í˜„ì¬</div>
                    <div style="color: white; font-weight: 600;">{{ analysis['USD']['current'] }}</div>
                </div>
                <div>
                    <div>30ì¼ í‰ê· </div>
                    <div style="color: white; font-weight: 600;">{{ analysis['USD']['avg'] }}</div>
                </div>
                <div>
                    <div>30ì¼ ìµœì €</div>
                    <div style="color: white; font-weight: 600;">{{ analysis['USD']['min'] }}</div>
                </div>
            </div>
        </div>

        <!-- JPY Advice -->
        <div class="advice-card"
            style="background: rgba(15, 23, 42, 0.4); padding: 1rem; border-radius: 12px; border: 1px solid rgba(255,255,255,0.05);">
            <div style="font-weight: bold; font-size: 1.1rem; margin-bottom: 0.5rem; color: #e2e8f0;">ğŸ‡¯ğŸ‡µ JPY/KRW
                (100ì—”) ì „ëµ</div>
            <div
                style="font-size: 1.2rem; font-weight: 800; margin-bottom: 0.5rem;
                color: {% if 'ë§¤ìˆ˜' in analysis['JPY']['status'] %}#4ade80{% elif 'ê´€ë§' in analysis['JPY']['status'] %}#f87171{% else %}#fbbf24{% endif %};">
                {{ analysis['JPY']['status'] }}
            </div>
            <p style="font-size: 0.9rem; color: #cbd5e1; margin-bottom: 1rem; line-height: 1.4;">{{
                analysis['JPY']['message'] }}</p>
            <div
                style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 0.5rem; font-size: 0.8rem; color: #94a3b8; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 0.5rem;">
                <div>
                    <div>í˜„ì¬</div>
                    <div style="color: white; font-weight: 600;">{{ analysis['JPY']['current'] }}</div>
                </div>
                <div>
                    <div>30ì¼ í‰ê· </div>
                    <div style="color: white; font-weight: 600;">{{ analysis['JPY']['avg'] }}</div>
                </div>
                <div>
                    <div>30ì¼ ìµœì €</div>
                    <div style="color: white; font-weight: 600;">{{ analysis['JPY']['min'] }}</div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endif %}
{% endif %}

<style>
    .styled-input {
        width: 100%;
        background: rgba(15, 23, 42, 0.6);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 8px;
        color: white;
        padding: 0.8rem;
    }

    .styled-select {
        width: 100%;
        background: rgba(15, 23, 42, 0.6);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 8px;
        color: white;
        padding: 0.8rem;
        font-size: 1rem;
        cursor: pointer;
    }

    .styled-select option {
        background: #1e293b;
        color: white;
    }

    @media (max-width: 768px) {
        div[style*="grid-template-columns"] {
            grid-template-columns: 1fr !important;
        }

        div[style*="text-align: center; font-size: 2rem;"] {
            transform: rotate(90deg);
        }
    }
</style>

<script>
    // Rates from server
    const rates = {{ rates | tojson }};
    const symbols = {
        "USD": "$", "KRW": "â‚©", "JPY": "Â¥", "EUR": "â‚¬",
        "GBP": "Â£", "CNY": "Â¥", "AUD": "A$", "CAD": "C$"
    };

    function convert() {
        const amount = parseFloat(document.getElementById('amount').value);
        const from = document.getElementById('fromCurr').value;
        const to = document.getElementById('toCurr').value;

        if (isNaN(amount)) return;

        // Convert to Base (USD) first
        // Rate is "How much of this currency for 1 USD"?
        // e.g. KRW = 1300. 1 USD = 1300 KRW.
        // Amount In USD = Amount / Rate

        let valInUsd = amount / rates[from];
        let valInTarget = valInUsd * rates[to];

        document.getElementById('resultValue').innerText =
            symbols[to] + " " + valInTarget.toLocaleString(undefined, { maximumFractionDigits: 2 });
    }

    document.getElementById('amount').addEventListener('input', convert);
    document.getElementById('fromCurr').addEventListener('change', convert);
    document.getElementById('toCurr').addEventListener('change', convert);

    // Initial call
    convert();
</script>
{% endblock %}