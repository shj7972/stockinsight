<!DOCTYPE html>
<html lang="ko">

<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-QZEJ22N8CY"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'G-QZEJ22N8CY');
    </script>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- SEO Meta Tags -->
    <meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1">
    <meta name="googlebot" content="index, follow">
    <meta name="Yeti" content="index, follow">
    <meta name="NaverBot" content="index, follow">
    <meta name="naver-site-verification" content="06fdf0f0fbda9341e58ab9a6b823f062b812c5f8">
    <meta name="google-adsense-account" content="ca-pub-2947913248390883">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2947913248390883"
        crossorigin="anonymous"></script>
    <meta name="description" content="{% block meta_description %}Stock Insight AI - ì‹¤ì‹œê°„ ì£¼ì‹ ë¶„ì„, AI ê¸°ë°˜ íˆ¬ì ì¡°ì–¸, ê¸€ë¡œë²Œ ì§€ìˆ˜ ë° ë‰´ìŠ¤ ê°ì„± ë¶„ì„ í”Œë«í¼{% endblock %}">
    <meta name="keywords" content="{% block meta_keywords %}ì£¼ì‹ë¶„ì„, AIíˆ¬ì, ì£¼ì‹ì°¨íŠ¸, íˆ¬ìì¡°ì–¸, ì£¼ì‹ë‰´ìŠ¤, ê°ì„±ë¶„ì„, ì‹¤ì‹œê°„ì§€ìˆ˜{% endblock %}">
    <meta property="og:title" content="{% block og_title %}Stock Insight AI - ìŠ¤ë§ˆíŠ¸ íˆ¬ì ë¶„ì„ í”Œë«í¼{% endblock %}">
    <meta property="og:description" content="{% block og_description %}AI ê¸°ë°˜ ì‹¤ì‹œê°„ ì£¼ì‹ ë¶„ì„ ë° íˆ¬ì ì¡°ì–¸ ì„œë¹„ìŠ¤{% endblock %}">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://stock-insight.app{% block og_url %}{% endblock %}">
    <meta property="og:image" content="https://stock-insight.app{{ og_image if og_image else '/static/og-image.png' }}">
    <meta property="og:locale" content="ko_KR">

    <!-- Favicon -->
    <link rel="icon" type="image/png" href="/static/favicon.png">

    <!-- Canonical URL -->
    <link rel="canonical" href="https://stock-insight.app{% block canonical_path %}{{ request.url.path }}{% endblock %}">

    <title>{% block title %}Stock Insight AI - ìŠ¤ë§ˆíŠ¸ íˆ¬ì ë¶„ì„ í”Œë«í¼{% endblock %}</title>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Outfit:wght@400;500;600;700&display=swap"
        rel="stylesheet">

    <!-- Plotly - Latest version -->
    <script src="https://cdn.plot.ly/plotly-2.35.2.min.js"></script>

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/static/styles.css?v=3">

    <!-- JSON-LD Structured Data -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebSite",
        "name": "Stock Insight AI",
        "url": "https://stock-insight.app",
        "description": "AI ê¸°ë°˜ ì‹¤ì‹œê°„ ì£¼ì‹ ë¶„ì„ ë° íˆ¬ì ì¡°ì–¸ í”Œë«í¼",
        "inLanguage": "ko",
        "potentialAction": {
            "@type": "SearchAction",
            "target": "https://stock-insight.app/stock/{search_term_string}",
            "query-input": "required name=search_term_string"
        },
        "publisher": {
            "@type": "Organization",
            "name": "Stock Insight AI",
            "url": "https://stock-insight.app",
            "logo": {
                "@type": "ImageObject",
                "url": "https://stock-insight.app/static/og-image.png"
            }
        }
    }
    </script>
    {% block structured_data %}{% endblock %}

    {% block extra_head %}{% endblock %}
</head>

<body>
    <!-- Loading Overlay -->
    <div id="loading-overlay" style="
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(15, 23, 42, 0.85);
        backdrop-filter: blur(5px);
        z-index: 9999;
        justify-content: center;
        align-items: center;
        flex-direction: column;
        color: white;
    ">
        <div class="spinner" style="
            width: 50px;
            height: 50px;
            border: 4px solid rgba(255,255,255,0.1);
            border-left-color: #38bdf8;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 1rem;
        "></div>
        <div style="font-size: 1.2rem; font-weight: bold;">ë°ì´í„° ë¶„ì„ ì¤‘...</div>
        <div style="font-size: 0.9rem; color: #94a3b8; margin-top: 0.5rem;">ìµœëŒ€ 5~10ì´ˆ ì •ë„ ì†Œìš”ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</div>
    </div>

    <style>
        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }
    </style>

    <div class="app-container">
        <!-- Mobile Menu Button -->
        <button class="mobile-menu-btn" onclick="toggleSidebar()" style="display: none;">
            â˜°
        </button>

        <!-- Sidebar (Search & Tools) -->
        <div class="sidebar-overlay" onclick="toggleSidebar()"></div>
        <aside class="sidebar">
            <div class="logo-container glass-panel">
                <a href="/" style="text-decoration: none;">
                    <div style="font-size: 3.5rem; margin-bottom: 1rem;">ğŸ“ˆ</div>
                    <h1>Stock Insight AI</h1>
                    <div class="logo-subtitle">Smart Investment Intelligence</div>
                    <div class="logo-line"></div>
                </a>
            </div>

            <form method="POST" action="/" class="ticker-form">
                <label for="ticker">í‹°ì»¤ ë˜ëŠ” ì¢…ëª©ëª… ì…ë ¥</label>
                <input type="text" id="ticker" name="ticker" value="{{ selected_ticker }}" placeholder="ì˜ˆ: AAPL"
                    required>
                <button type="submit">ê²€ìƒ‰</button>
            </form>

            <hr>

            <div class="ticker-section">
                <h3>ğŸ‡ºğŸ‡¸ ë¯¸êµ­ ì¸ê¸° TOP 10</h3>
                <div class="ticker-buttons">
                    {% for tick, name in us_tickers %}
                    <a href="/stock/{{ tick }}" class="ticker-btn">{{ name }} ({{ tick }})</a>
                    {% endfor %}
                </div>
            </div>

            <hr>

            <div class="ticker-section">
                <h3>ğŸ‡°ğŸ‡· í•œêµ­ ì¸ê¸° TOP 10</h3>
                <div class="ticker-buttons">
                    {% for tick, name in kr_tickers %}
                    <a href="/stock/{{ tick }}" class="ticker-btn">{{ name }} ({{ tick }})</a>
                    {% endfor %}
                </div>
            </div>

            <hr>



            <details class="tips-expander">
                <summary>ğŸ’¡ ì‚¬ìš© íŒ</summary>
                <p>ë¯¸êµ­ ì£¼ì‹ í‹°ì»¤ (ì˜ˆ: AAPL, TSLA) ë˜ëŠ” í•œêµ­ ì£¼ì‹ ì½”ë“œ (ì˜ˆ: 005930.KS)ë¥¼ ì…ë ¥í•˜ì„¸ìš”.</p>
            </details>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Navigation Tabs -->
            <nav class="content-nav">
                <a href="/" class="nav-item {% if request.url.path == '/' %}active{% endif %}">
                    <span>ğŸ“Š</span> ëŒ€ì‹œë³´ë“œ
                </a>
                <a href="/yield-calculator"
                    class="nav-item {% if request.url.path == '/yield-calculator' %}active{% endif %}">
                    <span>ğŸ§®</span> ìˆ˜ìµë¥  ê³„ì‚°ê¸°
                </a>
                <a href="/fear-greed-index"
                    class="nav-item {% if request.url.path == '/fear-greed-index' %}active{% endif %}">
                    <span>ğŸ˜¨</span> ê³µí¬/íƒìš• ì§€ìˆ˜
                </a>
                <a href="/exchange-rate"
                    class="nav-item {% if request.url.path == '/exchange-rate' %}active{% endif %}">
                    <span>ğŸ’±</span> í™˜ìœ¨ ê³„ì‚°ê¸°
                </a>
                <a href="/etf-explorer" class="nav-item {% if request.url.path == '/etf-explorer' %}active{% endif %}">
                    <span>ğŸ”­</span> ETF íƒí—˜ê°€
                </a>
                <a href="/sector-analysis"
                    class="nav-item {% if request.url.path == '/sector-analysis' %}active{% endif %}">
                    <span>ğŸ—ï¸</span> ì„¹í„° ë¶„ì„
                </a>
                <a href="/sentiment-analysis"
                    class="nav-item {% if request.url.path == '/sentiment-analysis' %}active{% endif %}">
                    <span>ğŸ“¢</span> ì†Œì…œ ì„¼í‹°ë¨¼íŠ¸
                </a>
            </nav>

            {% block content %}{% endblock %}

            <div class="footer-banner"
                style="display: flex; justify-content: center; gap: 1rem; flex-wrap: wrap; margin: 2rem 0;">
                {% for banner in get_random_banners() %}
                <a href="{{ banner.url }}" target="_blank" title="{{ banner.title }}">
                    <img src="{{ banner.img }}" alt="{{ banner.alt }}"
                        style="width:234px; height:60px; border: 1px solid #eee; border-radius: 4px;">
                </a>
                {% endfor %}
            </div>
            <!-- Footer -->
            <footer class="app-footer">
                <div class="footer-content">
                    <div class="footer-links">
                        <a href="/privacy-policy">ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨</a>
                        <span class="separator">|</span>
                        <a href="/terms-of-service">ì´ìš©ì•½ê´€</a>
                    </div>
                    <div class="footer-copyright">
                        &copy; 2026 Stock Insight AI. All rights reserved.
                    </div>
                    <div class="footer-note">
                        ë³¸ ì‚¬ì´íŠ¸ì˜ íˆ¬ì ì •ë³´ëŠ” ì°¸ê³ ìš©ì´ë©°, íˆ¬ìì˜ ì±…ì„ì€ ì‚¬ìš©ìì—ê²Œ ìˆìŠµë‹ˆë‹¤.
                    </div>
                </div>
            </footer>
        </main>
    </div>

    <!-- Loading Overlay -->
    <div id="loading-overlay">
        <div class="loader-content">
            <img src="/static/loading_icon.png" alt="Loading...">
            <div class="loader-text">AI ë¶„ì„ ì¤‘ì…ë‹ˆë‹¤...</div>
        </div>
    </div>

    <script>
        // Loading State & Double Submit Prevention
        document.addEventListener('DOMContentLoaded', () => {
            const overlay = document.getElementById('loading-overlay');
            const forms = document.querySelectorAll('form');
            const tickerBtns = document.querySelectorAll('.ticker-btn');

            forms.forEach(form => {
                form.addEventListener('submit', (e) => {
                    const submitBtn = form.querySelector('button[type="submit"]');

                    if (submitBtn) {
                        // Prevent double click
                        if (submitBtn.classList.contains('btn-disabled')) {
                            e.preventDefault();
                            return;
                        }

                        // Disable button & Show overlay
                        submitBtn.classList.add('btn-disabled');
                        submitBtn.innerHTML = 'ë¶„ì„ ì¤‘...';
                        overlay.style.display = 'flex';
                    }
                });
            });

            // Ticker Button Clicks (Sidebar)
            tickerBtns.forEach(btn => {
                btn.addEventListener('click', (e) => {
                    overlay.style.display = 'flex';
                });
            });
        });

        // Fix for "Back" button (Safari/Chrome BFCache)
        window.onpageshow = function (event) {
            if (event.persisted) {
                const overlay = document.getElementById('loading-overlay');
                if (overlay) overlay.style.display = 'none';

                const disabledBtns = document.querySelectorAll('.btn-disabled');
                disabledBtns.forEach(btn => {
                    btn.classList.remove('btn-disabled');
                    btn.innerHTML = 'ê²€ìƒ‰';
                });
            }
        };

        // Mobile Sidebar Toggle
        function toggleSidebar() {
            const sidebar = document.querySelector('.sidebar');
            const overlay = document.querySelector('.sidebar-overlay');
            sidebar.classList.toggle('active');
            overlay.classList.toggle('active');
        }
    </script>

    {% block extra_scripts %}{% endblock %}
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Links that require loading screen
            const heavyLinks = document.querySelectorAll('a[href="/sector-analysis"], a[href="/sentiment-analysis"]');
            const overlay = document.getElementById('loading-overlay');

            heavyLinks.forEach(link => {
                link.addEventListener('click', function (e) {
                    // Show overlay
                    overlay.style.display = 'flex';
                });
            });

            // Also show for cycle selector form submission in sector analysis
            const forms = document.querySelectorAll('form[action="/sector-analysis"]');
            forms.forEach(form => {
                form.addEventListener('submit', function () {
                    overlay.style.display = 'flex';
                });
            });
        });
    </script>
</body>

</html>