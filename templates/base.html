<!DOCTYPE html>
<html lang="ko">

<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-QZEJ22N8CY"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'G-QZEJ22N8CY');
    </script>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- SEO Meta Tags -->
    <meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1">
    <meta name="googlebot" content="index, follow">
    <meta name="Yeti" content="index, follow">
    <meta name="NaverBot" content="index, follow">
    <meta name="naver-site-verification" content="06fdf0f0fbda9341e58ab9a6b823f062b812c5f8">
    <meta name="google-adsense-account" content="ca-pub-2947913248390883">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2947913248390883"
        crossorigin="anonymous"></script>
    <meta name="description" content="{% block meta_description %}Stock Insight AI - ì‹¤ì‹œê°„ ì£¼ì‹ ë¶„ì„, AI ê¸°ë°˜ íˆ¬ì ì¡°ì–¸, ê¸€ë¡œë²Œ ì§€ìˆ˜ ë° ë‰´ìŠ¤ ê°ì„± ë¶„ì„ í”Œë«í¼{% endblock %}">
    <meta name="keywords" content="{% block meta_keywords %}ì£¼ì‹ë¶„ì„, AIíˆ¬ì, ì£¼ì‹ì°¨íŠ¸, íˆ¬ìì¡°ì–¸, ì£¼ì‹ë‰´ìŠ¤, ê°ì„±ë¶„ì„, ì‹¤ì‹œê°„ì§€ìˆ˜{% endblock %}">
    <meta property="og:title" content="{% block og_title %}Stock Insight AI - ìŠ¤ë§ˆíŠ¸ íˆ¬ì ë¶„ì„ í”Œë«í¼{% endblock %}">
    <meta property="og:description" content="{% block og_description %}AI ê¸°ë°˜ ì‹¤ì‹œê°„ ì£¼ì‹ ë¶„ì„ ë° íˆ¬ì ì¡°ì–¸ ì„œë¹„ìŠ¤{% endblock %}">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://stock-insight.app{% block og_url %}{% endblock %}">
    <meta property="og:image" content="https://stock-insight.app{{ og_image if og_image else '/static/og-image.png' }}">
    <meta property="og:locale" content="ko_KR">

    <!-- Favicon -->
    <link rel="icon" type="image/png" href="/static/favicon.png">

    <!-- Canonical URL -->
    <link rel="canonical" href="https://stock-insight.app{% block canonical_path %}{{ request.url.path }}{% endblock %}">

    <title>{% block title %}Stock Insight AI - ìŠ¤ë§ˆíŠ¸ íˆ¬ì ë¶„ì„ í”Œë«í¼{% endblock %}</title>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Outfit:wght@400;500;600;700&display=swap"
        rel="stylesheet">

    <!-- Plotly - Latest version -->
    <script src="https://cdn.plot.ly/plotly-2.35.2.min.js"></script>

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/static/styles.css?v=4">

    <!-- JSON-LD Structured Data -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebSite",
        "name": "Stock Insight AI",
        "url": "https://stock-insight.app",
        "description": "AI ê¸°ë°˜ ì‹¤ì‹œê°„ ì£¼ì‹ ë¶„ì„ ë° íˆ¬ì ì¡°ì–¸ í”Œë«í¼",
        "inLanguage": "ko",
        "potentialAction": {
            "@type": "SearchAction",
            "target": "https://stock-insight.app/stock/{search_term_string}",
            "query-input": "required name=search_term_string"
        },
        "publisher": {
            "@type": "Organization",
            "name": "Stock Insight AI",
            "url": "https://stock-insight.app",
            "logo": {
                "@type": "ImageObject",
                "url": "https://stock-insight.app/static/og-image.png"
            }
        }
    }
    </script>
    {% block structured_data %}{% endblock %}

    {% block extra_head %}{% endblock %}
</head>

<body>
    <!-- Loading Overlay -->
    <div id="loading-overlay" style="
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(15, 23, 42, 0.85);
        backdrop-filter: blur(5px);
        z-index: 9999;
        justify-content: center;
        align-items: center;
        flex-direction: column;
        color: white;
    ">
        <div class="spinner" style="
            width: 50px;
            height: 50px;
            border: 4px solid rgba(255,255,255,0.1);
            border-left-color: #38bdf8;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 1rem;
        "></div>
        <div style="font-size: 1.2rem; font-weight: bold;">ë°ì´í„° ë¶„ì„ ì¤‘...</div>
        <div style="font-size: 0.9rem; color: #94a3b8; margin-top: 0.5rem;">ìµœëŒ€ 5~10ì´ˆ ì •ë„ ì†Œìš”ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</div>
    </div>

    <style>
        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }
    </style>

    <div class="app-container">
        <!-- Mobile Menu Button -->
        <button class="mobile-menu-btn" onclick="toggleSidebar()" style="display: none;">
            â˜°
        </button>

        <!-- Sidebar (Search & Tools) -->
        <div class="sidebar-overlay" onclick="toggleSidebar()"></div>
        <aside class="sidebar">
            <div class="logo-container glass-panel">
                <a href="/" style="text-decoration: none;">
                    <div style="font-size: 3.5rem; margin-bottom: 1rem;">ğŸ“ˆ</div>
                    <h1>Stock Insight AI</h1>
                    <div class="logo-subtitle">Smart Investment Intelligence</div>
                    <div class="logo-line"></div>
                </a>
                <!-- Dark/Light Mode Toggle -->
                <button id="theme-toggle" onclick="toggleTheme()" title="í…Œë§ˆ ë³€ê²½"
                    style="margin-top: 1rem; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1);
                    border-radius: 20px; padding: 0.35rem 0.75rem; cursor: pointer; color: #94a3b8;
                    font-size: 0.78rem; display: flex; align-items: center; gap: 0.35rem; margin-left: auto; margin-right: auto;
                    transition: all 0.3s;">
                    <span id="theme-icon">ğŸŒ™</span> <span id="theme-label">ë‹¤í¬ ëª¨ë“œ</span>
                </button>
            </div>

            <form method="POST" action="/" class="ticker-form">
                <label for="ticker">í‹°ì»¤ ë˜ëŠ” ì¢…ëª©ëª… ì…ë ¥</label>
                <input type="text" id="ticker" name="ticker" value="{{ selected_ticker }}" placeholder="ì˜ˆ: AAPL"
                    required>
                <button type="submit">ê²€ìƒ‰</button>
            </form>

            <hr>

            <div class="ticker-section">
                <h3>ğŸ‡ºğŸ‡¸ ë¯¸êµ­ ì¸ê¸° TOP 10</h3>
                <div class="ticker-buttons">
                    {% for tick, name in us_tickers %}
                    <a href="/stock/{{ tick }}" class="ticker-btn">{{ name }} ({{ tick }})</a>
                    {% endfor %}
                </div>
            </div>

            <hr>

            <div class="ticker-section">
                <h3>ğŸ‡°ğŸ‡· í•œêµ­ ì¸ê¸° TOP 10</h3>
                <div class="ticker-buttons">
                    {% for tick, name in kr_tickers %}
                    <a href="/stock/{{ tick }}" class="ticker-btn">{{ name }} ({{ tick }})</a>
                    {% endfor %}
                </div>
            </div>

            <hr>



            <!-- Watchlist Section -->
            <div id="watchlist-section" class="ticker-section" style="display: none;">
                <div style="display: flex; align-items: center; justify-content: space-between;">
                    <h3>â­ ê´€ì‹¬ ì¢…ëª©</h3>
                    <button onclick="clearWatchlist()" title="ì „ì²´ ì‚­ì œ"
                        style="background: none; border: none; color: #64748b; cursor: pointer; font-size: 0.75rem; padding: 0.2rem 0.4rem;">
                        ì „ì²´ ì‚­ì œ
                    </button>
                </div>
                <div id="watchlist-items" class="ticker-buttons"></div>
            </div>

            <hr id="watchlist-hr" style="display: none;">

            <details class="tips-expander">
                <summary>ğŸ’¡ ì‚¬ìš© íŒ</summary>
                <p>ë¯¸êµ­ ì£¼ì‹ í‹°ì»¤ (ì˜ˆ: AAPL, TSLA) ë˜ëŠ” í•œêµ­ ì£¼ì‹ ì½”ë“œ (ì˜ˆ: 005930.KS)ë¥¼ ì…ë ¥í•˜ì„¸ìš”.</p>
            </details>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Navigation Tabs -->
            <nav class="content-nav">
                <a href="/" class="nav-item {% if request.url.path == '/' %}active{% endif %}">
                    <span>ğŸ“Š</span> ëŒ€ì‹œë³´ë“œ
                </a>
                <a href="/daily-report"
                    class="nav-item {% if request.url.path == '/daily-report' %}active{% endif %}">
                    <span>ğŸ“‹</span> ì¼ì¼ë¦¬í¬íŠ¸
                </a>
                <a href="/yield-calculator"
                    class="nav-item {% if request.url.path == '/yield-calculator' %}active{% endif %}">
                    <span>ğŸ§®</span> ìˆ˜ìµë¥  ê³„ì‚°ê¸°
                </a>
                <a href="/fear-greed-index"
                    class="nav-item {% if request.url.path == '/fear-greed-index' %}active{% endif %}">
                    <span>ğŸ˜¨</span> ê³µí¬/íƒìš• ì§€ìˆ˜
                </a>
                <a href="/exchange-rate"
                    class="nav-item {% if request.url.path == '/exchange-rate' %}active{% endif %}">
                    <span>ğŸ’±</span> í™˜ìœ¨ ê³„ì‚°ê¸°
                </a>
                <a href="/etf-explorer" class="nav-item {% if request.url.path == '/etf-explorer' %}active{% endif %}">
                    <span>ğŸ”­</span> ETF íƒí—˜ê°€
                </a>
                <a href="/sector-analysis"
                    class="nav-item {% if request.url.path == '/sector-analysis' %}active{% endif %}">
                    <span>ğŸ—ï¸</span> ì„¹í„° ë¶„ì„
                </a>
                <a href="/sentiment-analysis"
                    class="nav-item {% if request.url.path == '/sentiment-analysis' %}active{% endif %}">
                    <span>ğŸ“¢</span> ì†Œì…œ ì„¼í‹°ë¨¼íŠ¸
                </a>
                <a href="/economic-indicators"
                    class="nav-item {% if request.url.path == '/economic-indicators' %}active{% endif %}">
                    <span>ğŸ“ˆ</span> ê²½ì œì§€í‘œ
                </a>
                <a href="/compare"
                    class="nav-item {% if request.url.path == '/compare' %}active{% endif %}">
                    <span>âš–ï¸</span> ì¢…ëª©ë¹„êµ
                </a>
                <a href="/portfolio-simulator"
                    class="nav-item {% if request.url.path == '/portfolio-simulator' %}active{% endif %}">
                    <span>ğŸ’¼</span> í¬íŠ¸í´ë¦¬ì˜¤
                </a>
                <a href="/blog"
                    class="nav-item {% if '/blog' in request.url.path %}active{% endif %}">
                    <span>ğŸ“</span> ë¸”ë¡œê·¸
                </a>
            </nav>

            {% block content %}{% endblock %}

            <div class="footer-banner"
                style="display: flex; justify-content: center; gap: 1rem; flex-wrap: wrap; margin: 2rem 0;">
                {% for banner in get_random_banners() %}
                <a href="{{ banner.url }}" target="_blank" title="{{ banner.title }}">
                    <img src="{{ banner.img }}" alt="{{ banner.alt }}"
                        style="width:234px; height:60px; border: 1px solid #eee; border-radius: 4px;">
                </a>
                {% endfor %}
            </div>
            <!-- Newsletter Section -->
            <div class="glass-panel" style="padding: 1.25rem; margin-bottom: 1.5rem; text-align: center;">
                <h3 style="margin: 0 0 0.5rem 0; font-size: 1rem;">ğŸ“© ì£¼ê°„ íˆ¬ì ì¸ì‚¬ì´íŠ¸ êµ¬ë…</h3>
                <p style="color: #94a3b8; font-size: 0.82rem; margin: 0 0 0.75rem 0;">
                    ë§¤ì£¼ ì‹œì¥ ìš”ì•½, AI ë¶„ì„ ë¦¬í¬íŠ¸, í•µì‹¬ íˆ¬ì ì „ëµì„ ì´ë©”ì¼ë¡œ ë°›ì•„ë³´ì„¸ìš”.
                </p>
                <form id="newsletter-form" onsubmit="subscribeNewsletter(event)"
                    style="display: flex; gap: 0.5rem; max-width: 420px; margin: 0 auto;">
                    <input type="email" id="newsletter-email" placeholder="ì´ë©”ì¼ ì£¼ì†Œ ì…ë ¥" required
                        style="flex: 1; background: rgba(15,23,42,0.6); border: 1px solid rgba(255,255,255,0.1);
                        border-radius: 10px; color: #f8fafc; padding: 0.5rem 0.75rem; font-size: 0.85rem; box-sizing: border-box;">
                    <button type="submit"
                        style="padding: 0.5rem 1.2rem; background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%);
                        color: white; border: none; border-radius: 10px; font-weight: 600; cursor: pointer;
                        font-size: 0.82rem; white-space: nowrap;">
                        êµ¬ë…í•˜ê¸°
                    </button>
                </form>
                <div id="newsletter-result" style="margin-top: 0.5rem;"></div>
            </div>

            <!-- Footer -->
            <footer class="app-footer">
                <div class="footer-content">
                    <div class="footer-links">
                        <a href="/privacy-policy">ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨</a>
                        <span class="separator">|</span>
                        <a href="/terms-of-service">ì´ìš©ì•½ê´€</a>
                    </div>
                    <div class="footer-copyright">
                        &copy; 2026 Stock Insight AI. All rights reserved.
                    </div>
                    <div class="footer-note">
                        ë³¸ ì‚¬ì´íŠ¸ì˜ íˆ¬ì ì •ë³´ëŠ” ì°¸ê³ ìš©ì´ë©°, íˆ¬ìì˜ ì±…ì„ì€ ì‚¬ìš©ìì—ê²Œ ìˆìŠµë‹ˆë‹¤.
                    </div>
                </div>
            </footer>
        </main>
    </div>

    <!-- Loading Overlay -->
    <div id="loading-overlay">
        <div class="loader-content">
            <img src="/static/loading_icon.png" alt="Loading...">
            <div class="loader-text">AI ë¶„ì„ ì¤‘ì…ë‹ˆë‹¤...</div>
        </div>
    </div>

    <script>
        // Loading State & Double Submit Prevention
        document.addEventListener('DOMContentLoaded', () => {
            const overlay = document.getElementById('loading-overlay');
            const forms = document.querySelectorAll('form');
            const tickerBtns = document.querySelectorAll('.ticker-btn');

            forms.forEach(form => {
                form.addEventListener('submit', (e) => {
                    const submitBtn = form.querySelector('button[type="submit"]');

                    if (submitBtn) {
                        // Prevent double click
                        if (submitBtn.classList.contains('btn-disabled')) {
                            e.preventDefault();
                            return;
                        }

                        // Disable button & Show overlay
                        submitBtn.classList.add('btn-disabled');
                        submitBtn.innerHTML = 'ë¶„ì„ ì¤‘...';
                        overlay.style.display = 'flex';
                    }
                });
            });

            // Ticker Button Clicks (Sidebar)
            tickerBtns.forEach(btn => {
                btn.addEventListener('click', (e) => {
                    overlay.style.display = 'flex';
                });
            });
        });

        // Fix for "Back" button (Safari/Chrome BFCache)
        window.onpageshow = function (event) {
            if (event.persisted) {
                const overlay = document.getElementById('loading-overlay');
                if (overlay) overlay.style.display = 'none';

                const disabledBtns = document.querySelectorAll('.btn-disabled');
                disabledBtns.forEach(btn => {
                    btn.classList.remove('btn-disabled');
                    btn.innerHTML = 'ê²€ìƒ‰';
                });
            }
        };

        // Mobile Sidebar Toggle
        function toggleSidebar() {
            const sidebar = document.querySelector('.sidebar');
            const overlay = document.querySelector('.sidebar-overlay');
            sidebar.classList.toggle('active');
            overlay.classList.toggle('active');
        }
    </script>

    <!-- Scroll to Top Button -->
    <button class="scroll-top-btn" id="scroll-top-btn" onclick="window.scrollTo({top:0,behavior:'smooth'})">â†‘</button>
    <script>
    window.addEventListener('scroll', function() {
        const btn = document.getElementById('scroll-top-btn');
        if (btn) { btn.style.display = window.scrollY > 400 ? 'flex' : 'none'; }
    });
    </script>

    <!-- Watchlist Logic (localStorage) -->
    <script>
        const WATCHLIST_KEY = 'stock_insight_watchlist';

        function getWatchlist() {
            try {
                return JSON.parse(localStorage.getItem(WATCHLIST_KEY)) || [];
            } catch { return []; }
        }

        function saveWatchlist(list) {
            localStorage.setItem(WATCHLIST_KEY, JSON.stringify(list));
        }

        function addToWatchlist(ticker, name) {
            const list = getWatchlist();
            if (!list.find(item => item.ticker === ticker)) {
                list.unshift({ ticker, name });
                if (list.length > 20) list.pop();
                saveWatchlist(list);
                renderWatchlist();
            }
        }

        function removeFromWatchlist(ticker) {
            const list = getWatchlist().filter(item => item.ticker !== ticker);
            saveWatchlist(list);
            renderWatchlist();
        }

        function clearWatchlist() {
            saveWatchlist([]);
            renderWatchlist();
        }

        function isInWatchlist(ticker) {
            return getWatchlist().some(item => item.ticker === ticker);
        }

        function renderWatchlist() {
            const list = getWatchlist();
            const section = document.getElementById('watchlist-section');
            const hr = document.getElementById('watchlist-hr');
            const container = document.getElementById('watchlist-items');

            if (!section || !container) return;

            if (list.length === 0) {
                section.style.display = 'none';
                if (hr) hr.style.display = 'none';
                return;
            }

            section.style.display = 'block';
            if (hr) hr.style.display = 'block';

            container.innerHTML = list.map(item => `
                <div style="display: flex; align-items: center; gap: 0.25rem;">
                    <a href="/stock/${item.ticker}" class="ticker-btn" style="flex: 1;">
                        ${item.name} (${item.ticker})
                    </a>
                    <button onclick="removeFromWatchlist('${item.ticker}')" title="ì‚­ì œ"
                        style="background: none; border: none; color: #64748b; cursor: pointer;
                               font-size: 0.75rem; padding: 0.2rem; flex-shrink: 0; line-height: 1;">
                        âœ•
                    </button>
                </div>
            `).join('');

            // Update star buttons on stock pages
            updateWatchlistButtons();
        }

        function updateWatchlistButtons() {
            document.querySelectorAll('.watchlist-toggle-btn').forEach(btn => {
                const ticker = btn.dataset.ticker;
                if (isInWatchlist(ticker)) {
                    btn.innerHTML = 'â­ ê´€ì‹¬ ì¢…ëª©';
                    btn.style.background = 'linear-gradient(135deg, rgba(251,191,36,0.15) 0%, rgba(245,158,11,0.15) 100%)';
                    btn.style.borderColor = 'rgba(251,191,36,0.4)';
                    btn.style.color = '#fbbf24';
                } else {
                    btn.innerHTML = 'â˜† ê´€ì‹¬ ì¢…ëª© ì¶”ê°€';
                    btn.style.background = 'linear-gradient(135deg, rgba(56,189,248,0.1) 0%, rgba(129,140,248,0.1) 100%)';
                    btn.style.borderColor = 'rgba(56,189,248,0.3)';
                    btn.style.color = '#38bdf8';
                }
            });
        }

        function toggleWatchlist(ticker, name) {
            if (isInWatchlist(ticker)) {
                removeFromWatchlist(ticker);
            } else {
                addToWatchlist(ticker, name);
            }
        }

        // Init watchlist on page load
        document.addEventListener('DOMContentLoaded', renderWatchlist);
    </script>

    <!-- Newsletter Subscription -->
    <script>
    async function subscribeNewsletter(e) {
        e.preventDefault();
        const email = document.getElementById('newsletter-email').value;
        const resultDiv = document.getElementById('newsletter-result');
        const form = document.getElementById('newsletter-form');

        try {
            const formData = new FormData();
            formData.append('email', email);

            const resp = await fetch('/api/newsletter', {method: 'POST', body: formData});
            const html = await resp.text();
            resultDiv.innerHTML = html;
            if (resp.ok) {
                document.getElementById('newsletter-email').value = '';
            }
        } catch (err) {
            resultDiv.innerHTML = '<div style="color:#f87171;font-size:0.82rem;">âŒ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</div>';
        }
    }
    </script>

    <!-- Dark/Light Theme Toggle -->
    <script>
    function toggleTheme() {
        const body = document.body;
        const isLight = body.classList.toggle('light-mode');
        localStorage.setItem('stock_insight_theme', isLight ? 'light' : 'dark');
        updateThemeButton(isLight);
    }

    function updateThemeButton(isLight) {
        const icon = document.getElementById('theme-icon');
        const label = document.getElementById('theme-label');
        if (icon && label) {
            icon.textContent = isLight ? 'â˜€ï¸' : 'ğŸŒ™';
            label.textContent = isLight ? 'ë¼ì´íŠ¸ ëª¨ë“œ' : 'ë‹¤í¬ ëª¨ë“œ';
        }
    }

    // Apply saved theme on load
    (function() {
        const saved = localStorage.getItem('stock_insight_theme');
        if (saved === 'light') {
            document.body.classList.add('light-mode');
            // Update button after DOM is ready
            document.addEventListener('DOMContentLoaded', function() {
                updateThemeButton(true);
            });
        }
    })();
    </script>

    {% block extra_scripts %}{% endblock %}
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Links that require loading screen
            const heavyLinks = document.querySelectorAll('a[href="/sector-analysis"], a[href="/sentiment-analysis"]');
            const overlay = document.getElementById('loading-overlay');

            heavyLinks.forEach(link => {
                link.addEventListener('click', function (e) {
                    // Show overlay
                    overlay.style.display = 'flex';
                });
            });

            // Also show for cycle selector form submission in sector analysis
            const forms = document.querySelectorAll('form[action="/sector-analysis"]');
            forms.forEach(form => {
                form.addEventListener('submit', function () {
                    overlay.style.display = 'flex';
                });
            });
        });
    </script>
</body>

</html>